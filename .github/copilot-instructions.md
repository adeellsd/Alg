# RENTALG Copilot Instructions

## üß† Project Context
**RENTALG** is an Algerian real estate marketplace connecting buyers/renters with individuals and professionals.
- **Stack**: Next.js 14+ (App Router), Express.js, PostgreSQL (PostGIS), Prisma, AWS Amplify (Auth), Redux Toolkit.
- **Monorepo Structure**:
  - `/client`: Next.js frontend.
  - `/server`: Express backend.

## üèóÔ∏è Architecture & Data Flow
- **Client-Server Communication**:
  - The client uses **RTK Query** (`client/src/state/api.ts`) for data fetching.
  - **Authentication**: AWS Cognito via Amplify. ID tokens are passed in the `Authorization` header.
  - **User Resolution**: The frontend determines the user endpoint (`/pro/:id` or `/particulier/:id`) based on the `custom:role` claim in the Cognito token.
- **Database**:
  - **Prisma** is the ORM. `schema.prisma` is the single source of truth.
  - **PostGIS** is used for geospatial features (location-based search).
  - **Type Sharing**: Server types are generated by Prisma and **copied** to the client via the `postprisma:generate` script (`client/src/types/prismaTypes.d.ts`).

## üõ†Ô∏è Critical Workflows
- **Database Updates**:
  - After modifying `server/prisma/schema.prisma`, ALWAYS run:
    ```bash
    cd server && npm run prisma:generate
    ```
    *Note: This automatically copies types to the client via the `postprisma:generate` hook.*
- **Authentication**:
  - When implementing protected routes/endpoints, verify the `Authorization` header using the Cognito JWKS.
  - User roles (`PARTICULIER`, `PROFESSIONNEL`) dictate accessible endpoints.

## üé® UI/UX Guidelines
- **Components**: Use **Shadcn UI** components located in `client/src/components/ui`.
- **Styling**: Tailwind CSS.
- **Maps**: Mapbox GL integration for property location and search.
- **Forms**: React Hook Form + Zod validation.

## üö® Project-Specific Conventions
- **Type Safety**:
  - Do NOT manually define API response types in the client if they mirror DB models. Import them from `@/types/prismaTypes`.
- **State Management**:
  - Use Redux Toolkit for global state (auth, preferences).
  - Use RTK Query for server state.
- **Geography**:
  - The project handles Algerian administrative divisions (Wilayas, Communes). Ensure data validation respects these hierarchies.

## üß™ Testing & Debugging
- **Server**: Run `npm run dev` in `/server`.
- **Client**: Run `npm run dev` in `/client`.
- **Logs**: Check server console for "aw yemchi..." to confirm startup.
